"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// scripts/list-aws-resources.ts
const client_ec2_1 = require("@aws-sdk/client-ec2");
const credential_providers_1 = require("@aws-sdk/credential-providers");
// Configuraci√≥n
const REGION = process.env.AWS_REGION || 'us-east-1';
const PROFILE = process.env.AWS_PROFILE || '127358876881_AWS-SNA-DevOps';
const client = new client_ec2_1.EC2Client({
    region: REGION,
    credentials: (0, credential_providers_1.fromIni)({ profile: PROFILE })
});
async function listVpcs() {
    console.log('üì° Obteniendo VPCs...');
    const command = new client_ec2_1.DescribeVpcsCommand({});
    const response = await client.send(command);
    return (response.Vpcs || []).map(vpc => ({
        vpcId: vpc.VpcId || '',
        cidrBlock: vpc.CidrBlock || '',
        isDefault: vpc.IsDefault || false,
        tags: (vpc.Tags || []).reduce((acc, tag) => {
            if (tag.Key && tag.Value)
                acc[tag.Key] = tag.Value;
            return acc;
        }, {})
    }));
}
async function listSubnets() {
    console.log('üì° Obteniendo Subnets...');
    const command = new client_ec2_1.DescribeSubnetsCommand({});
    const response = await client.send(command);
    return (response.Subnets || []).map(subnet => ({
        subnetId: subnet.SubnetId || '',
        vpcId: subnet.VpcId || '',
        cidrBlock: subnet.CidrBlock || '',
        availabilityZone: subnet.AvailabilityZone || '',
        availableIpAddressCount: subnet.AvailableIpAddressCount || 0,
        tags: (subnet.Tags || []).reduce((acc, tag) => {
            if (tag.Key && tag.Value)
                acc[tag.Key] = tag.Value;
            return acc;
        }, {})
    }));
}
async function listSecurityGroups() {
    console.log('üì° Obteniendo Security Groups...');
    const command = new client_ec2_1.DescribeSecurityGroupsCommand({});
    const response = await client.send(command);
    return (response.SecurityGroups || []).map(sg => {
        const inboundRules = (sg.IpPermissions || []).map(perm => {
            const protocol = perm.IpProtocol === '-1' ? 'All' : perm.IpProtocol || '';
            const fromPort = perm.FromPort;
            const toPort = perm.ToPort;
            // Obtener fuentes (IPs, grupos, etc)
            const sources = [];
            if (perm.IpRanges && perm.IpRanges.length > 0) {
                sources.push(...perm.IpRanges.map(ip => ip.CidrIp || ''));
            }
            if (perm.Ipv6Ranges && perm.Ipv6Ranges.length > 0) {
                sources.push(...perm.Ipv6Ranges.map(ip => ip.CidrIpv6 || ''));
            }
            if (perm.UserIdGroupPairs && perm.UserIdGroupPairs.length > 0) {
                sources.push(...perm.UserIdGroupPairs.map(pair => pair.GroupId || ''));
            }
            return {
                protocol,
                fromPort,
                toPort,
                source: sources.join(', ') || 'N/A',
                description: perm.IpRanges?.[0]?.Description || perm.UserIdGroupPairs?.[0]?.Description || ''
            };
        });
        const outboundRules = (sg.IpPermissionsEgress || []).map(perm => {
            const protocol = perm.IpProtocol === '-1' ? 'All' : perm.IpProtocol || '';
            const fromPort = perm.FromPort;
            const toPort = perm.ToPort;
            const destinations = [];
            if (perm.IpRanges && perm.IpRanges.length > 0) {
                destinations.push(...perm.IpRanges.map(ip => ip.CidrIp || ''));
            }
            if (perm.Ipv6Ranges && perm.Ipv6Ranges.length > 0) {
                destinations.push(...perm.Ipv6Ranges.map(ip => ip.CidrIpv6 || ''));
            }
            if (perm.UserIdGroupPairs && perm.UserIdGroupPairs.length > 0) {
                destinations.push(...perm.UserIdGroupPairs.map(pair => pair.GroupId || ''));
            }
            return {
                protocol,
                fromPort,
                toPort,
                source: destinations.join(', ') || 'N/A',
                description: perm.IpRanges?.[0]?.Description || perm.UserIdGroupPairs?.[0]?.Description || ''
            };
        });
        return {
            groupId: sg.GroupId || '',
            groupName: sg.GroupName || '',
            description: sg.Description || '',
            vpcId: sg.VpcId || '',
            inboundRules,
            outboundRules,
            tags: (sg.Tags || []).reduce((acc, tag) => {
                if (tag.Key && tag.Value)
                    acc[tag.Key] = tag.Value;
                return acc;
            }, {})
        };
    });
}
async function listRouteTables() {
    console.log('üì° Obteniendo Route Tables...');
    try {
        const command = new client_ec2_1.DescribeRouteTablesCommand({});
        const response = await client.send(command);
        return (response.RouteTables || []).map(rt => {
            const routes = (rt.Routes || []).map(route => ({
                destinationCidrBlock: route.DestinationCidrBlock,
                destinationIpv6CidrBlock: route.DestinationIpv6CidrBlock,
                gatewayId: route.GatewayId,
                natGatewayId: route.NatGatewayId,
                vpcPeeringConnectionId: route.VpcPeeringConnectionId,
                transitGatewayId: route.TransitGatewayId,
                instanceId: route.InstanceId,
                networkInterfaceId: route.NetworkInterfaceId,
                state: route.State
            }));
            const associations = (rt.Associations || []).map(assoc => ({
                subnetId: assoc.SubnetId,
                main: assoc.Main || false
            }));
            return {
                routeTableId: rt.RouteTableId || '',
                vpcId: rt.VpcId || '',
                routes,
                associations,
                tags: (rt.Tags || []).reduce((acc, tag) => {
                    if (tag.Key && tag.Value)
                        acc[tag.Key] = tag.Value;
                    return acc;
                }, {})
            };
        });
    }
    catch (error) {
        if (error.Code === 'UnauthorizedOperation') {
            console.log('‚ö†Ô∏è  No tienes permisos para ec2:DescribeRouteTables');
            return [];
        }
        throw error;
    }
}
function printVpcs(vpcs) {
    console.log('\nüåê ==================== VPCs ====================');
    vpcs.forEach((vpc, index) => {
        console.log(`\n${index + 1}. VPC ID: ${vpc.vpcId}`);
        console.log(`   CIDR Block: ${vpc.cidrBlock}`);
        console.log(`   Default: ${vpc.isDefault ? 'Yes' : 'No'}`);
        if (Object.keys(vpc.tags).length > 0) {
            console.log('   Tags:');
            Object.entries(vpc.tags).forEach(([key, value]) => {
                console.log(`     - ${key}: ${value}`);
            });
        }
    });
}
function printSubnets(subnets) {
    console.log('\nüîå ==================== SUBNETS ====================');
    subnets.forEach((subnet, index) => {
        console.log(`\n${index + 1}. Subnet ID: ${subnet.subnetId}`);
        console.log(`   VPC ID: ${subnet.vpcId}`);
        console.log(`   CIDR Block: ${subnet.cidrBlock}`);
        console.log(`   Availability Zone: ${subnet.availabilityZone}`);
        console.log(`   Available IPs: ${subnet.availableIpAddressCount}`);
        if (Object.keys(subnet.tags).length > 0) {
            console.log('   Tags:');
            Object.entries(subnet.tags).forEach(([key, value]) => {
                console.log(`     - ${key}: ${value}`);
            });
        }
    });
}
function printSecurityGroups(securityGroups) {
    console.log('\nüîí ==================== SECURITY GROUPS ====================');
    securityGroups.forEach((sg, index) => {
        console.log(`\n${index + 1}. Security Group ID: ${sg.groupId}`);
        console.log(`   Name: ${sg.groupName}`);
        console.log(`   Description: ${sg.description}`);
        console.log(`   VPC ID: ${sg.vpcId}`);
        if (Object.keys(sg.tags).length > 0) {
            console.log('   Tags:');
            Object.entries(sg.tags).forEach(([key, value]) => {
                console.log(`     - ${key}: ${value}`);
            });
        }
        console.log('\n   üì• INBOUND RULES:');
        if (sg.inboundRules.length === 0) {
            console.log('     ‚ö†Ô∏è  No inbound rules');
        }
        else {
            sg.inboundRules.forEach((rule, ruleIndex) => {
                const portRange = rule.fromPort && rule.toPort
                    ? `Port ${rule.fromPort}${rule.fromPort !== rule.toPort ? `-${rule.toPort}` : ''}`
                    : 'All ports';
                console.log(`     ${ruleIndex + 1}. Protocol: ${rule.protocol} | ${portRange}`);
                console.log(`        Source: ${rule.source}`);
                if (rule.description) {
                    console.log(`        Description: ${rule.description}`);
                }
            });
        }
        console.log('\n   üì§ OUTBOUND RULES:');
        if (sg.outboundRules.length === 0) {
            console.log('     ‚ö†Ô∏è  No outbound rules');
        }
        else {
            sg.outboundRules.forEach((rule, ruleIndex) => {
                const portRange = rule.fromPort && rule.toPort
                    ? `Port ${rule.fromPort}${rule.fromPort !== rule.toPort ? `-${rule.toPort}` : ''}`
                    : 'All ports';
                console.log(`     ${ruleIndex + 1}. Protocol: ${rule.protocol} | ${portRange}`);
                console.log(`        Destination: ${rule.source}`);
                if (rule.description) {
                    console.log(`        Description: ${rule.description}`);
                }
            });
        }
    });
}
function printRouteTables(routeTables) {
    console.log('\nüõ£Ô∏è  ==================== ROUTE TABLES ====================');
    routeTables.forEach((rt, index) => {
        console.log(`\n${index + 1}. Route Table ID: ${rt.routeTableId}`);
        console.log(`   VPC ID: ${rt.vpcId}`);
        if (Object.keys(rt.tags).length > 0) {
            console.log('   Tags:');
            Object.entries(rt.tags).forEach(([key, value]) => {
                console.log(`     - ${key}: ${value}`);
            });
        }
        console.log('\n   üó∫Ô∏è  ROUTES:');
        if (rt.routes.length === 0) {
            console.log('     ‚ö†Ô∏è  No routes');
        }
        else {
            rt.routes.forEach((route, routeIndex) => {
                const destination = route.destinationCidrBlock || route.destinationIpv6CidrBlock || 'N/A';
                const target = route.gatewayId || route.natGatewayId || route.vpcPeeringConnectionId ||
                    route.transitGatewayId || route.instanceId || route.networkInterfaceId || 'N/A';
                const state = route.state || 'unknown';
                console.log(`     ${routeIndex + 1}. Destination: ${destination}`);
                console.log(`        Target: ${target}`);
                console.log(`        State: ${state}`);
            });
        }
        console.log('\n   üîó ASSOCIATIONS:');
        if (rt.associations.length === 0) {
            console.log('     ‚ö†Ô∏è  No associations');
        }
        else {
            rt.associations.forEach((assoc, assocIndex) => {
                if (assoc.main) {
                    console.log(`     ${assocIndex + 1}. Main route table (applies to all subnets without explicit association)`);
                }
                else if (assoc.subnetId) {
                    console.log(`     ${assocIndex + 1}. Subnet: ${assoc.subnetId}`);
                }
            });
        }
    });
}
async function main() {
    try {
        console.log('üöÄ Listando recursos de AWS...');
        console.log(`üìç Regi√≥n: ${REGION}`);
        console.log(`üë§ Perfil: ${PROFILE}\n`);
        // Obtener todos los recursos
        const [vpcs, subnets, securityGroups, routeTables] = await Promise.all([
            listVpcs(),
            listSubnets(),
            listSecurityGroups(),
            listRouteTables()
        ]);
        // Imprimir en consola
        printVpcs(vpcs);
        printSubnets(subnets);
        printSecurityGroups(securityGroups);
        printRouteTables(routeTables);
        console.log(`\nüìä Resumen:`);
        console.log(`   - VPCs: ${vpcs.length}`);
        console.log(`   - Subnets: ${subnets.length}`);
        console.log(`   - Security Groups: ${securityGroups.length}`);
        console.log(`   - Route Tables: ${routeTables.length}`);
    }
    catch (error) {
        console.error('‚ùå Error:', error);
        process.exit(1);
    }
}
main();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC1hd3MtcmVzb3VyY2VzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibGlzdC1hd3MtcmVzb3VyY2VzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsZ0NBQWdDO0FBQ2hDLG9EQUF3SjtBQUN4Six3RUFBd0Q7QUFHeEQsZ0JBQWdCO0FBQ2hCLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxJQUFJLFdBQVcsQ0FBQztBQUNyRCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsSUFBSSw2QkFBNkIsQ0FBQztBQUV6RSxNQUFNLE1BQU0sR0FBRyxJQUFJLHNCQUFTLENBQUM7SUFDM0IsTUFBTSxFQUFFLE1BQU07SUFDZCxXQUFXLEVBQUUsSUFBQSw4QkFBTyxFQUFDLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDO0NBQzNDLENBQUMsQ0FBQztBQTJESCxLQUFLLFVBQVUsUUFBUTtJQUNyQixPQUFPLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLENBQUM7SUFDckMsTUFBTSxPQUFPLEdBQUcsSUFBSSxnQ0FBbUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUM1QyxNQUFNLFFBQVEsR0FBRyxNQUFNLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFNUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN2QyxLQUFLLEVBQUUsR0FBRyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3RCLFNBQVMsRUFBRSxHQUFHLENBQUMsU0FBUyxJQUFJLEVBQUU7UUFDOUIsU0FBUyxFQUFFLEdBQUcsQ0FBQyxTQUFTLElBQUksS0FBSztRQUNqQyxJQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxH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LE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDN0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCLGNBQWMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQzlELE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLFdBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBRTFELENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDakMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsQixDQUFDO0FBQ0gsQ0FBQztBQUVELElBQUksRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gc2NyaXB0cy9saXN0LWF3cy1yZXNvdXJjZXMudHNcbmltcG9ydCB7IEVDMkNsaWVudCwgRGVzY3JpYmVWcGNzQ29tbWFuZCwgRGVzY3JpYmVTdWJuZXRzQ29tbWFuZCwgRGVzY3JpYmVTZWN1cml0eUdyb3Vwc0NvbW1hbmQsIERlc2NyaWJlUm91dGVUYWJsZXNDb21tYW5kIH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWVjMic7XG5pbXBvcnQgeyBmcm9tSW5pIH0gZnJvbSAnQGF3cy1zZGsvY3JlZGVudGlhbC1wcm92aWRlcnMnO1xuXG5cbi8vIENvbmZpZ3VyYWNpw7NuXG5jb25zdCBSRUdJT04gPSBwcm9jZXNzLmVudi5BV1NfUkVHSU9OIHx8ICd1cy1lYXN0LTEnO1xuY29uc3QgUFJPRklMRSA9IHByb2Nlc3MuZW52LkFXU19QUk9GSUxFIHx8ICcxMjczNTg4NzY4ODFfQVdTLVNOQS1EZXZPcHMnO1xuXG5jb25zdCBjbGllbnQgPSBuZXcgRUMyQ2xpZW50KHtcbiAgcmVnaW9uOiBSRUdJT04sXG4gIGNyZWRlbnRpYWxzOiBmcm9tSW5pKHsgcHJvZmlsZTogUFJPRklMRSB9KVxufSk7XG5cbmludGVyZmFjZSBTZWN1cml0eUdyb3VwUnVsZSB7XG4gIHByb3RvY29sOiBzdHJpbmc7XG4gIGZyb21Qb3J0PzogbnVtYmVyO1xuICB0b1BvcnQ/OiBudW1iZXI7XG4gIHNvdXJjZT86IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBTZWN1cml0eUdyb3VwSW5mbyB7XG4gIGdyb3VwSWQ6IHN0cmluZztcbiAgZ3JvdXBOYW1lOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIHZwY0lkOiBzdHJpbmc7XG4gIGluYm91bmRSdWxlczogU2VjdXJpdHlHcm91cFJ1bGVbXTtcbiAgb3V0Ym91bmRSdWxlczogU2VjdXJpdHlHcm91cFJ1bGVbXTtcbiAgdGFnczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfTtcbn1cblxuaW50ZXJmYWNlIFN1Ym5ldEluZm8ge1xuICBzdWJuZXRJZDogc3RyaW5nO1xuICB2cGNJZDogc3RyaW5nO1xuICBjaWRyQmxvY2s6IHN0cmluZztcbiAgYXZhaWxhYmlsaXR5Wm9uZTogc3RyaW5nO1xuICBhdmFpbGFibGVJcEFkZHJlc3NDb3VudDogbnVtYmVyO1xuICB0YWdzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9O1xufVxuXG5pbnRlcmZhY2UgVnBjSW5mbyB7XG4gIHZwY0lkOiBzdHJpbmc7XG4gIGNpZHJCbG9jazogc3RyaW5nO1xuICBpc0RlZmF1bHQ6IGJvb2xlYW47XG4gIHRhZ3M6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH07XG59XG5cbmludGVyZmFjZSBSb3V0ZUluZm8ge1xuICBkZXN0aW5hdGlvbkNpZHJCbG9jaz86IHN0cmluZztcbiAgZGVzdGluYXRpb25JcHY2Q2lkckJsb2NrPzogc3RyaW5nO1xuICBnYXRld2F5SWQ/OiBzdHJpbmc7XG4gIG5hdEdhdGV3YXlJZD86IHN0cmluZztcbiAgdnBjUGVlcmluZ0Nvbm5lY3Rpb25JZD86IHN0cmluZztcbiAgdHJhbnNpdEdhdGV3YXlJZD86IHN0cmluZztcbiAgaW5zdGFuY2VJZD86IHN0cmluZztcbiAgbmV0d29ya0ludGVyZmFjZUlkPzogc3RyaW5nO1xuICBzdGF0ZT86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFJvdXRlVGFibGVJbmZvIHtcbiAgcm91dGVUYWJsZUlkOiBzdHJpbmc7XG4gIHZwY0lkOiBzdHJpbmc7XG4gIHJvdXRlczogUm91dGVJbmZvW107XG4gIGFzc29jaWF0aW9uczoge1xuICAgIHN1Ym5ldElkPzogc3RyaW5nO1xuICAgIG1haW46IGJvb2xlYW47XG4gIH1bXTtcbiAgdGFnczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gbGlzdFZwY3MoKTogUHJvbWlzZTxWcGNJbmZvW10+IHtcbiAgY29uc29sZS5sb2coJ/Cfk6EgT2J0ZW5pZW5kbyBWUENzLi4uJyk7XG4gIGNvbnN0IGNvbW1hbmQgPSBuZXcgRGVzY3JpYmVWcGNzQ29tbWFuZCh7fSk7XG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LnNlbmQoY29tbWFuZCk7XG4gIFxuICByZXR1cm4gKHJlc3BvbnNlLlZwY3MgfHwgW10pLm1hcCh2cGMgPT4gKHtcbiAgICB2cGNJZDogdnBjLlZwY0lkIHx8ICcnLFxuICAgIGNpZHJCbG9jazogdnBjLkNpZHJCbG9jayB8fCAnJyxcbiAgICBpc0RlZmF1bHQ6IHZwYy5Jc0RlZmF1bHQgfHwgZmFsc2UsXG4gICAgdGFnczogKHZwYy5UYWdzIHx8IFtdKS5yZWR1Y2UoKGFjYywgdGFnKSA9PiB7XG4gICAgICBpZiAodGFnLktleSAmJiB0YWcuVmFsdWUpIGFjY1t0YWcuS2V5XSA9IHRhZy5WYWx1ZTtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30gYXMgeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSlcbiAgfSkpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBsaXN0U3VibmV0cygpOiBQcm9taXNlPFN1Ym5ldEluZm9bXT4ge1xuICBjb25zb2xlLmxvZygn8J+ToSBPYnRlbmllbmRvIFN1Ym5ldHMuLi4nKTtcbiAgY29uc3QgY29tbWFuZCA9IG5ldyBEZXNjcmliZVN1Ym5ldHNDb21tYW5kKHt9KTtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuc2VuZChjb21tYW5kKTtcbiAgXG4gIHJldHVybiAocmVzcG9uc2UuU3VibmV0cyB8fCBbXSkubWFwKHN1Ym5ldCA9PiAoe1xuICAgIHN1Ym5ldElkOiBzdWJuZXQuU3VibmV0SWQgfHwgJycsXG4gICAgdnBjSWQ6IHN1Ym5ldC5WcGNJZCB8fCAnJyxcbiAgICBjaWRyQmxvY2s6IHN1Ym5ldC5DaWRyQmxvY2sgfHwgJycsXG4gICAgYXZhaWxhYmlsaXR5Wm9uZTogc3VibmV0LkF2YWlsYWJpbGl0eVpvbmUgfHwgJycsXG4gICAgYXZhaWxhYmxlSXBBZGRyZXNzQ291bnQ6IHN1Ym5ldC5BdmFpbGFibGVJcEFkZHJlc3NDb3VudCB8fCAwLFxuICAgIHRhZ3M6IChzdWJuZXQuVGFncyB8fCBbXSkucmVkdWNlKChhY2MsIHRhZykgPT4ge1xuICAgICAgaWYgKHRhZy5LZXkgJiYgdGFnLlZhbHVlKSBhY2NbdGFnLktleV0gPSB0YWcuVmFsdWU7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9IGFzIHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0pXG4gIH0pKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gbGlzdFNlY3VyaXR5R3JvdXBzKCk6IFByb21pc2U8U2VjdXJpdHlHcm91cEluZm9bXT4ge1xuICBjb25zb2xlLmxvZygn8J+ToSBPYnRlbmllbmRvIFNlY3VyaXR5IEdyb3Vwcy4uLicpO1xuICBjb25zdCBjb21tYW5kID0gbmV3IERlc2NyaWJlU2VjdXJpdHlHcm91cHNDb21tYW5kKHt9KTtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuc2VuZChjb21tYW5kKTtcbiAgXG4gIHJldHVybiAocmVzcG9uc2UuU2VjdXJpdHlHcm91cHMgfHwgW10pLm1hcChzZyA9PiB7XG4gICAgY29uc3QgaW5ib3VuZFJ1bGVzOiBTZWN1cml0eUdyb3VwUnVsZVtdID0gKHNnLklwUGVybWlzc2lvbnMgfHwgW10pLm1hcChwZXJtID0+IHtcbiAgICAgIGNvbnN0IHByb3RvY29sID0gcGVybS5JcFByb3RvY29sID09PSAnLTEnID8gJ0FsbCcgOiBwZXJtLklwUHJvdG9jb2wgfHwgJyc7XG4gICAgICBjb25zdCBmcm9tUG9ydCA9IHBlcm0uRnJvbVBvcnQ7XG4gICAgICBjb25zdCB0b1BvcnQgPSBwZXJtLlRvUG9ydDtcbiAgICAgIFxuICAgICAgLy8gT2J0ZW5lciBmdWVudGVzIChJUHMsIGdydXBvcywgZXRjKVxuICAgICAgY29uc3Qgc291cmNlczogc3RyaW5nW10gPSBbXTtcbiAgICAgIFxuICAgICAgaWYgKHBlcm0uSXBSYW5nZXMgJiYgcGVybS5JcFJhbmdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHNvdXJjZXMucHVzaCguLi5wZXJtLklwUmFuZ2VzLm1hcChpcCA9PiBpcC5DaWRySXAgfHwgJycpKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKHBlcm0uSXB2NlJhbmdlcyAmJiBwZXJtLklwdjZSYW5nZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBzb3VyY2VzLnB1c2goLi4ucGVybS5JcHY2UmFuZ2VzLm1hcChpcCA9PiBpcC5DaWRySXB2NiB8fCAnJykpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAocGVybS5Vc2VySWRHcm91cFBhaXJzICYmIHBlcm0uVXNlcklkR3JvdXBQYWlycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHNvdXJjZXMucHVzaCguLi5wZXJtLlVzZXJJZEdyb3VwUGFpcnMubWFwKHBhaXIgPT4gcGFpci5Hcm91cElkIHx8ICcnKSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByb3RvY29sLFxuICAgICAgICBmcm9tUG9ydCxcbiAgICAgICAgdG9Qb3J0LFxuICAgICAgICBzb3VyY2U6IHNvdXJjZXMuam9pbignLCAnKSB8fCAnTi9BJyxcbiAgICAgICAgZGVzY3JpcHRpb246IHBlcm0uSXBSYW5nZXM/LlswXT8uRGVzY3JpcHRpb24gfHwgcGVybS5Vc2VySWRHcm91cFBhaXJzPy5bMF0/LkRlc2NyaXB0aW9uIHx8ICcnXG4gICAgICB9O1xuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IG91dGJvdW5kUnVsZXM6IFNlY3VyaXR5R3JvdXBSdWxlW10gPSAoc2cuSXBQZXJtaXNzaW9uc0VncmVzcyB8fCBbXSkubWFwKHBlcm0gPT4ge1xuICAgICAgY29uc3QgcHJvdG9jb2wgPSBwZXJtLklwUHJvdG9jb2wgPT09ICctMScgPyAnQWxsJyA6IHBlcm0uSXBQcm90b2NvbCB8fCAnJztcbiAgICAgIGNvbnN0IGZyb21Qb3J0ID0gcGVybS5Gcm9tUG9ydDtcbiAgICAgIGNvbnN0IHRvUG9ydCA9IHBlcm0uVG9Qb3J0O1xuICAgICAgXG4gICAgICBjb25zdCBkZXN0aW5hdGlvbnM6IHN0cmluZ1tdID0gW107XG4gICAgICBcbiAgICAgIGlmIChwZXJtLklwUmFuZ2VzICYmIHBlcm0uSXBSYW5nZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBkZXN0aW5hdGlvbnMucHVzaCguLi5wZXJtLklwUmFuZ2VzLm1hcChpcCA9PiBpcC5DaWRySXAgfHwgJycpKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKHBlcm0uSXB2NlJhbmdlcyAmJiBwZXJtLklwdjZSYW5nZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBkZXN0aW5hdGlvbnMucHVzaCguLi5wZXJtLklwdjZSYW5nZXMubWFwKGlwID0+IGlwLkNpZHJJcHY2IHx8ICcnKSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChwZXJtLlVzZXJJZEdyb3VwUGFpcnMgJiYgcGVybS5Vc2VySWRHcm91cFBhaXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZGVzdGluYXRpb25zLnB1c2goLi4ucGVybS5Vc2VySWRHcm91cFBhaXJzLm1hcChwYWlyID0+IHBhaXIuR3JvdXBJZCB8fCAnJykpO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwcm90b2NvbCxcbiAgICAgICAgZnJvbVBvcnQsXG4gICAgICAgIHRvUG9ydCxcbiAgICAgICAgc291cmNlOiBkZXN0aW5hdGlvbnMuam9pbignLCAnKSB8fCAnTi9BJyxcbiAgICAgICAgZGVzY3JpcHRpb246IHBlcm0uSXBSYW5nZXM/LlswXT8uRGVzY3JpcHRpb24gfHwgcGVybS5Vc2VySWRHcm91cFBhaXJzPy5bMF0/LkRlc2NyaXB0aW9uIHx8ICcnXG4gICAgICB9O1xuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBncm91cElkOiBzZy5Hcm91cElkIHx8ICcnLFxuICAgICAgZ3JvdXBOYW1lOiBzZy5Hcm91cE5hbWUgfHwgJycsXG4gICAgICBkZXNjcmlwdGlvbjogc2cuRGVzY3JpcHRpb24gfHwgJycsXG4gICAgICB2cGNJZDogc2cuVnBjSWQgfHwgJycsXG4gICAgICBpbmJvdW5kUnVsZXMsXG4gICAgICBvdXRib3VuZFJ1bGVzLFxuICAgICAgdGFnczogKHNnLlRhZ3MgfHwgW10pLnJlZHVjZSgoYWNjLCB0YWcpID0+IHtcbiAgICAgICAgaWYgKHRhZy5LZXkgJiYgdGFnLlZhbHVlKSBhY2NbdGFnLktleV0gPSB0YWcuVmFsdWU7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LCB7fSBhcyB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9KVxuICAgIH07XG4gIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBsaXN0Um91dGVUYWJsZXMoKTogUHJvbWlzZTxSb3V0ZVRhYmxlSW5mb1tdPiB7XG4gIGNvbnNvbGUubG9nKCfwn5OhIE9idGVuaWVuZG8gUm91dGUgVGFibGVzLi4uJyk7XG4gIHRyeSB7XG4gICAgY29uc3QgY29tbWFuZCA9IG5ldyBEZXNjcmliZVJvdXRlVGFibGVzQ29tbWFuZCh7fSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuc2VuZChjb21tYW5kKTtcbiAgICBcbiAgICByZXR1cm4gKHJlc3BvbnNlLlJvdXRlVGFibGVzIHx8IFtdKS5tYXAocnQgPT4ge1xuICAgICAgY29uc3Qgcm91dGVzOiBSb3V0ZUluZm9bXSA9IChydC5Sb3V0ZXMgfHwgW10pLm1hcChyb3V0ZSA9PiAoe1xuICAgICAgICBkZXN0aW5hdGlvbkNpZHJCbG9jazogcm91dGUuRGVzdGluYXRpb25DaWRyQmxvY2ssXG4gICAgICAgIGRlc3RpbmF0aW9uSXB2NkNpZHJCbG9jazogcm91dGUuRGVzdGluYXRpb25JcHY2Q2lkckJsb2NrLFxuICAgICAgICBnYXRld2F5SWQ6IHJvdXRlLkdhdGV3YXlJZCxcbiAgICAgICAgbmF0R2F0ZXdheUlkOiByb3V0ZS5OYXRHYXRld2F5SWQsXG4gICAgICAgIHZwY1BlZXJpbmdDb25uZWN0aW9uSWQ6IHJvdXRlLlZwY1BlZXJpbmdDb25uZWN0aW9uSWQsXG4gICAgICAgIHRyYW5zaXRHYXRld2F5SWQ6IHJvdXRlLlRyYW5zaXRHYXRld2F5SWQsXG4gICAgICAgIGluc3RhbmNlSWQ6IHJvdXRlLkluc3RhbmNlSWQsXG4gICAgICAgIG5ldHdvcmtJbnRlcmZhY2VJZDogcm91dGUuTmV0d29ya0ludGVyZmFjZUlkLFxuICAgICAgICBzdGF0ZTogcm91dGUuU3RhdGVcbiAgICAgIH0pKTtcbiAgICAgIFxuICAgICAgY29uc3QgYXNzb2NpYXRpb25zID0gKHJ0LkFzc29jaWF0aW9ucyB8fCBbXSkubWFwKGFzc29jID0+ICh7XG4gICAgICAgIHN1Ym5ldElkOiBhc3NvYy5TdWJuZXRJZCxcbiAgICAgICAgbWFpbjogYXNzb2MuTWFpbiB8fCBmYWxzZVxuICAgICAgfSkpO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICByb3V0ZVRhYmxlSWQ6IHJ0LlJvdXRlVGFibGVJZCB8fCAnJyxcbiAgICAgICAgdnBjSWQ6IHJ0LlZwY0lkIHx8ICcnLFxuICAgICAgICByb3V0ZXMsXG4gICAgICAgIGFzc29jaWF0aW9ucyxcbiAgICAgICAgdGFnczogKHJ0LlRhZ3MgfHwgW10pLnJlZHVjZSgoYWNjLCB0YWcpID0+IHtcbiAgICAgICAgICBpZiAodGFnLktleSAmJiB0YWcuVmFsdWUpIGFjY1t0YWcuS2V5XSA9IHRhZy5WYWx1ZTtcbiAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICB9LCB7fSBhcyB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9KVxuICAgICAgfTtcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGlmIChlcnJvci5Db2RlID09PSAnVW5hdXRob3JpemVkT3BlcmF0aW9uJykge1xuICAgICAgY29uc29sZS5sb2coJ+KaoO+4jyAgTm8gdGllbmVzIHBlcm1pc29zIHBhcmEgZWMyOkRlc2NyaWJlUm91dGVUYWJsZXMnKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuZnVuY3Rpb24gcHJpbnRWcGNzKHZwY3M6IFZwY0luZm9bXSkge1xuICBjb25zb2xlLmxvZygnXFxu8J+MkCA9PT09PT09PT09PT09PT09PT09PSBWUENzID09PT09PT09PT09PT09PT09PT09Jyk7XG4gIHZwY3MuZm9yRWFjaCgodnBjLCBpbmRleCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBcXG4ke2luZGV4ICsgMX0uIFZQQyBJRDogJHt2cGMudnBjSWR9YCk7XG4gICAgY29uc29sZS5sb2coYCAgIENJRFIgQmxvY2s6ICR7dnBjLmNpZHJCbG9ja31gKTtcbiAgICBjb25zb2xlLmxvZyhgICAgRGVmYXVsdDogJHt2cGMuaXNEZWZhdWx0ID8gJ1llcycgOiAnTm8nfWApO1xuICAgIGlmIChPYmplY3Qua2V5cyh2cGMudGFncykubGVuZ3RoID4gMCkge1xuICAgICAgY29uc29sZS5sb2coJyAgIFRhZ3M6Jyk7XG4gICAgICBPYmplY3QuZW50cmllcyh2cGMudGFncykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAgIC0gJHtrZXl9OiAke3ZhbHVlfWApO1xuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gcHJpbnRTdWJuZXRzKHN1Ym5ldHM6IFN1Ym5ldEluZm9bXSkge1xuICBjb25zb2xlLmxvZygnXFxu8J+UjCA9PT09PT09PT09PT09PT09PT09PSBTVUJORVRTID09PT09PT09PT09PT09PT09PT09Jyk7XG4gIHN1Ym5ldHMuZm9yRWFjaCgoc3VibmV0LCBpbmRleCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBcXG4ke2luZGV4ICsgMX0uIFN1Ym5ldCBJRDogJHtzdWJuZXQuc3VibmV0SWR9YCk7XG4gICAgY29uc29sZS5sb2coYCAgIFZQQyBJRDogJHtzdWJuZXQudnBjSWR9YCk7XG4gICAgY29uc29sZS5sb2coYCAgIENJRFIgQmxvY2s6ICR7c3VibmV0LmNpZHJCbG9ja31gKTtcbiAgICBjb25zb2xlLmxvZyhgICAgQXZhaWxhYmlsaXR5IFpvbmU6ICR7c3VibmV0LmF2YWlsYWJpbGl0eVpvbmV9YCk7XG4gICAgY29uc29sZS5sb2coYCAgIEF2YWlsYWJsZSBJUHM6ICR7c3VibmV0LmF2YWlsYWJsZUlwQWRkcmVzc0NvdW50fWApO1xuICAgIGlmIChPYmplY3Qua2V5cyhzdWJuZXQudGFncykubGVuZ3RoID4gMCkge1xuICAgICAgY29uc29sZS5sb2coJyAgIFRhZ3M6Jyk7XG4gICAgICBPYmplY3QuZW50cmllcyhzdWJuZXQudGFncykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAgIC0gJHtrZXl9OiAke3ZhbHVlfWApO1xuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gcHJpbnRTZWN1cml0eUdyb3VwcyhzZWN1cml0eUdyb3VwczogU2VjdXJpdHlHcm91cEluZm9bXSkge1xuICBjb25zb2xlLmxvZygnXFxu8J+UkiA9PT09PT09PT09PT09PT09PT09PSBTRUNVUklUWSBHUk9VUFMgPT09PT09PT09PT09PT09PT09PT0nKTtcbiAgc2VjdXJpdHlHcm91cHMuZm9yRWFjaCgoc2csIGluZGV4KSA9PiB7XG4gICAgY29uc29sZS5sb2coYFxcbiR7aW5kZXggKyAxfS4gU2VjdXJpdHkgR3JvdXAgSUQ6ICR7c2cuZ3JvdXBJZH1gKTtcbiAgICBjb25zb2xlLmxvZyhgICAgTmFtZTogJHtzZy5ncm91cE5hbWV9YCk7XG4gICAgY29uc29sZS5sb2coYCAgIERlc2NyaXB0aW9uOiAke3NnLmRlc2NyaXB0aW9ufWApO1xuICAgIGNvbnNvbGUubG9nKGAgICBWUEMgSUQ6ICR7c2cudnBjSWR9YCk7XG4gICAgXG4gICAgaWYgKE9iamVjdC5rZXlzKHNnLnRhZ3MpLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKCcgICBUYWdzOicpO1xuICAgICAgT2JqZWN0LmVudHJpZXMoc2cudGFncykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAgIC0gJHtrZXl9OiAke3ZhbHVlfWApO1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKCdcXG4gICDwn5OlIElOQk9VTkQgUlVMRVM6Jyk7XG4gICAgaWYgKHNnLmluYm91bmRSdWxlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKCcgICAgIOKaoO+4jyAgTm8gaW5ib3VuZCBydWxlcycpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZy5pbmJvdW5kUnVsZXMuZm9yRWFjaCgocnVsZSwgcnVsZUluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IHBvcnRSYW5nZSA9IHJ1bGUuZnJvbVBvcnQgJiYgcnVsZS50b1BvcnQgXG4gICAgICAgICAgPyBgUG9ydCAke3J1bGUuZnJvbVBvcnR9JHtydWxlLmZyb21Qb3J0ICE9PSBydWxlLnRvUG9ydCA/IGAtJHtydWxlLnRvUG9ydH1gIDogJyd9YFxuICAgICAgICAgIDogJ0FsbCBwb3J0cyc7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAgICR7cnVsZUluZGV4ICsgMX0uIFByb3RvY29sOiAke3J1bGUucHJvdG9jb2x9IHwgJHtwb3J0UmFuZ2V9YCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAgICAgIFNvdXJjZTogJHtydWxlLnNvdXJjZX1gKTtcbiAgICAgICAgaWYgKHJ1bGUuZGVzY3JpcHRpb24pIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgICAgICAgICBEZXNjcmlwdGlvbjogJHtydWxlLmRlc2NyaXB0aW9ufWApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coJ1xcbiAgIPCfk6QgT1VUQk9VTkQgUlVMRVM6Jyk7XG4gICAgaWYgKHNnLm91dGJvdW5kUnVsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zb2xlLmxvZygnICAgICDimqDvuI8gIE5vIG91dGJvdW5kIHJ1bGVzJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNnLm91dGJvdW5kUnVsZXMuZm9yRWFjaCgocnVsZSwgcnVsZUluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IHBvcnRSYW5nZSA9IHJ1bGUuZnJvbVBvcnQgJiYgcnVsZS50b1BvcnQgXG4gICAgICAgICAgPyBgUG9ydCAke3J1bGUuZnJvbVBvcnR9JHtydWxlLmZyb21Qb3J0ICE9PSBydWxlLnRvUG9ydCA/IGAtJHtydWxlLnRvUG9ydH1gIDogJyd9YFxuICAgICAgICAgIDogJ0FsbCBwb3J0cyc7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAgICR7cnVsZUluZGV4ICsgMX0uIFByb3RvY29sOiAke3J1bGUucHJvdG9jb2x9IHwgJHtwb3J0UmFuZ2V9YCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAgICAgIERlc3RpbmF0aW9uOiAke3J1bGUuc291cmNlfWApO1xuICAgICAgICBpZiAocnVsZS5kZXNjcmlwdGlvbikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGAgICAgICAgIERlc2NyaXB0aW9uOiAke3J1bGUuZGVzY3JpcHRpb259YCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHByaW50Um91dGVUYWJsZXMocm91dGVUYWJsZXM6IFJvdXRlVGFibGVJbmZvW10pIHtcbiAgY29uc29sZS5sb2coJ1xcbvCfm6PvuI8gID09PT09PT09PT09PT09PT09PT09IFJPVVRFIFRBQkxFUyA9PT09PT09PT09PT09PT09PT09PScpO1xuICByb3V0ZVRhYmxlcy5mb3JFYWNoKChydCwgaW5kZXgpID0+IHtcbiAgICBjb25zb2xlLmxvZyhgXFxuJHtpbmRleCArIDF9LiBSb3V0ZSBUYWJsZSBJRDogJHtydC5yb3V0ZVRhYmxlSWR9YCk7XG4gICAgY29uc29sZS5sb2coYCAgIFZQQyBJRDogJHtydC52cGNJZH1gKTtcbiAgICBcbiAgICBpZiAoT2JqZWN0LmtleXMocnQudGFncykubGVuZ3RoID4gMCkge1xuICAgICAgY29uc29sZS5sb2coJyAgIFRhZ3M6Jyk7XG4gICAgICBPYmplY3QuZW50cmllcyhydC50YWdzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coYCAgICAgLSAke2tleX06ICR7dmFsdWV9YCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coJ1xcbiAgIPCfl7rvuI8gIFJPVVRFUzonKTtcbiAgICBpZiAocnQucm91dGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc29sZS5sb2coJyAgICAg4pqg77iPICBObyByb3V0ZXMnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcnQucm91dGVzLmZvckVhY2goKHJvdXRlLCByb3V0ZUluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gcm91dGUuZGVzdGluYXRpb25DaWRyQmxvY2sgfHwgcm91dGUuZGVzdGluYXRpb25JcHY2Q2lkckJsb2NrIHx8ICdOL0EnO1xuICAgICAgICBjb25zdCB0YXJnZXQgPSByb3V0ZS5nYXRld2F5SWQgfHwgcm91dGUubmF0R2F0ZXdheUlkIHx8IHJvdXRlLnZwY1BlZXJpbmdDb25uZWN0aW9uSWQgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgcm91dGUudHJhbnNpdEdhdGV3YXlJZCB8fCByb3V0ZS5pbnN0YW5jZUlkIHx8IHJvdXRlLm5ldHdvcmtJbnRlcmZhY2VJZCB8fCAnTi9BJztcbiAgICAgICAgY29uc3Qgc3RhdGUgPSByb3V0ZS5zdGF0ZSB8fCAndW5rbm93bic7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhgICAgICAke3JvdXRlSW5kZXggKyAxfS4gRGVzdGluYXRpb246ICR7ZGVzdGluYXRpb259YCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAgICAgIFRhcmdldDogJHt0YXJnZXR9YCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAgICAgIFN0YXRlOiAke3N0YXRlfWApO1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKCdcXG4gICDwn5SXIEFTU09DSUFUSU9OUzonKTtcbiAgICBpZiAocnQuYXNzb2NpYXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc29sZS5sb2coJyAgICAg4pqg77iPICBObyBhc3NvY2lhdGlvbnMnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcnQuYXNzb2NpYXRpb25zLmZvckVhY2goKGFzc29jLCBhc3NvY0luZGV4KSA9PiB7XG4gICAgICAgIGlmIChhc3NvYy5tYWluKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYCAgICAgJHthc3NvY0luZGV4ICsgMX0uIE1haW4gcm91dGUgdGFibGUgKGFwcGxpZXMgdG8gYWxsIHN1Ym5ldHMgd2l0aG91dCBleHBsaWNpdCBhc3NvY2lhdGlvbilgKTtcbiAgICAgICAgfSBlbHNlIGlmIChhc3NvYy5zdWJuZXRJZCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGAgICAgICR7YXNzb2NJbmRleCArIDF9LiBTdWJuZXQ6ICR7YXNzb2Muc3VibmV0SWR9YCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIG1haW4oKSB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coJ/CfmoAgTGlzdGFuZG8gcmVjdXJzb3MgZGUgQVdTLi4uJyk7XG4gICAgY29uc29sZS5sb2coYPCfk40gUmVnacOzbjogJHtSRUdJT059YCk7XG4gICAgY29uc29sZS5sb2coYPCfkaQgUGVyZmlsOiAke1BST0ZJTEV9XFxuYCk7XG4gICAgXG4gICAgLy8gT2J0ZW5lciB0b2RvcyBsb3MgcmVjdXJzb3NcbiAgICBjb25zdCBbdnBjcywgc3VibmV0cywgc2VjdXJpdHlHcm91cHMsIHJvdXRlVGFibGVzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgIGxpc3RWcGNzKCksXG4gICAgICBsaXN0U3VibmV0cygpLFxuICAgICAgbGlzdFNlY3VyaXR5R3JvdXBzKCksXG4gICAgICBsaXN0Um91dGVUYWJsZXMoKVxuICAgIF0pO1xuICAgIFxuICAgIC8vIEltcHJpbWlyIGVuIGNvbnNvbGFcbiAgICBwcmludFZwY3ModnBjcyk7XG4gICAgcHJpbnRTdWJuZXRzKHN1Ym5ldHMpO1xuICAgIHByaW50U2VjdXJpdHlHcm91cHMoc2VjdXJpdHlHcm91cHMpO1xuICAgIHByaW50Um91dGVUYWJsZXMocm91dGVUYWJsZXMpO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKGBcXG7wn5OKIFJlc3VtZW46YCk7XG4gICAgY29uc29sZS5sb2coYCAgIC0gVlBDczogJHt2cGNzLmxlbmd0aH1gKTtcbiAgICBjb25zb2xlLmxvZyhgICAgLSBTdWJuZXRzOiAke3N1Ym5ldHMubGVuZ3RofWApO1xuICAgIGNvbnNvbGUubG9nKGAgICAtIFNlY3VyaXR5IEdyb3VwczogJHtzZWN1cml0eUdyb3Vwcy5sZW5ndGh9YCk7XG4gICAgY29uc29sZS5sb2coYCAgIC0gUm91dGUgVGFibGVzOiAke3JvdXRlVGFibGVzLmxlbmd0aH1gKTtcbiAgICBcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3I6JywgZXJyb3IpO1xuICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgfVxufVxuXG5tYWluKCk7Il19